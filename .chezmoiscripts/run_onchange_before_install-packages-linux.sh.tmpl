{{- if eq .chezmoi.os "linux" -}}
#!/bin/bash
set -e

echo "ðŸ§ Installing packages for Linux (Ubuntu)..."

# Update apt
sudo apt update

# Core packages
echo "Installing core packages..."
sudo apt install -y \
  tmux \
  ripgrep \
  fd-find \
  fzf \
  git \
  zsh \
  curl \
  wget \
  build-essential \
  python3 \
  python3-pip \
  docker.io

# Neovim (latest via AppImage - apt version is too old)
if ! command -v nvim &> /dev/null || [[ $(nvim --version | head -1 | grep -oP '\d+\.\d+' | head -1) < "0.10" ]]; then
  echo "Installing latest Neovim..."
  curl -Lo /tmp/nvim.appimage https://github.com/neovim/neovim/releases/latest/download/nvim.appimage
  chmod u+x /tmp/nvim.appimage
  sudo mv /tmp/nvim.appimage /usr/local/bin/nvim
fi

# Starship
if ! command -v starship &> /dev/null; then
  echo "Installing Starship..."
  curl -sS https://starship.rs/install.sh | sh -s -- -y
fi

# Lazygit
if ! command -v lazygit &> /dev/null; then
  echo "Installing Lazygit..."
  LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
  curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
  tar xf lazygit.tar.gz lazygit
  sudo install lazygit /usr/local/bin
  rm lazygit lazygit.tar.gz
fi

# age (encryption)
if ! command -v age &> /dev/null; then
  echo "Installing age..."
  sudo apt install -y age
fi

# WezTerm
if ! command -v wezterm &> /dev/null; then
  echo "Installing WezTerm..."
  curl -fsSL https://apt.fury.io/wez/gpg.key | sudo gpg --yes --dearmor -o /usr/share/keyrings/wezterm-fury.gpg
  echo 'deb [signed-by=/usr/share/keyrings/wezterm-fury.gpg] https://apt.fury.io/wez/ * *' | sudo tee /etc/apt/sources.list.d/wezterm.list
  sudo apt update
  sudo apt install -y wezterm
fi

# Postman (via snap)
if command -v snap &> /dev/null; then
  if ! snap list postman &> /dev/null; then
    echo "Installing Postman..."
    sudo snap install postman
  fi
fi

# Nerd Font Symbols
if [ ! -f "$HOME/.local/share/fonts/SymbolsNerdFont-Regular.ttf" ]; then
  echo "Installing Nerd Font Symbols..."
  mkdir -p ~/.local/share/fonts
  curl -fLo ~/.local/share/fonts/SymbolsNerdFont-Regular.ttf \
    https://github.com/ryanoasis/nerd-fonts/raw/master/patched-fonts/NerdFontsSymbolsOnly/SymbolsNerdFont-Regular.ttf
  fc-cache -fv
fi

# pyenv
if [ ! -d "$HOME/.pyenv" ]; then
  echo "Installing pyenv..."
  curl https://pyenv.run | bash
fi

# nvm
if [ ! -d "$HOME/.nvm" ]; then
  echo "Installing nvm..."
  curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
fi

# TPM
if [ ! -d "$HOME/.tmux/plugins/tpm" ]; then
  echo "Installing TPM..."
  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

# Oh-My-Zsh
if [ ! -d "$HOME/.oh-my-zsh" ]; then
  echo "Installing Oh-My-Zsh..."
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended
fi

# Set zsh as default shell
if [ "$SHELL" != "$(which zsh)" ]; then
  echo "Setting zsh as default shell..."
  chsh -s $(which zsh)
fi

echo "âœ… Linux packages installed!"
{{- end -}}
